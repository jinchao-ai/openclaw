name: Monitor OpenClaw Release
on:
  release:
    types: [published]
  workflow_dispatch:

jobs:
  send-notification:
    runs-on: ubuntu-latest
    steps:
      - name: Send DingTalk notification (Shell only)
        env:
          WEBHOOK: ${{ secrets.DINGTALK_WEBHOOK }}
          VERSION: ${{ github.event.release.tag_name || 'æµ‹è¯•ç‰ˆæœ¬' }}
          TITLE: ${{ github.event.release.name || 'æµ‹è¯•æ ‡é¢˜' }}
          DESCRIPTION: ${{ github.event.release.body || 'æ— æ›´æ–°æè¿°' }}
          URL: ${{ github.event.release.html_url || '#' }}
        run: |
          # å¤„ç†æ¢è¡Œç¬¦ï¼Œæ›¿æ¢ä¸ºé’‰é’‰æ”¯æŒçš„<br>
          DESCRIPTION=$(echo "$DESCRIPTION" | sed ':a;N;$!ba;s/\n/<br>/g')
          
          # æ„é€ é’‰é’‰æ¶ˆæ¯çš„JSONå†…å®¹
          JSON_PAYLOAD=$(cat <<EOF
          {
            "msgtype": "markdown",
            "markdown": {
              "title": "OpenClaw ç‰ˆæœ¬æ›´æ–°",
              "text": "### ğŸš¨ OpenClaw æ–°ç‰ˆæœ¬å‘å¸ƒ ğŸš¨<br>- **ç‰ˆæœ¬å·**: $VERSION<br>- **æ ‡é¢˜**: $TITLE<br>- **æ›´æ–°å†…å®¹**: $DESCRIPTION<br>- **æŸ¥çœ‹è¯¦æƒ…**: [ç‚¹å‡»è·³è½¬]($URL)"
            }
          }
          EOF
          )
          
          # å‘é€POSTè¯·æ±‚åˆ°é’‰é’‰æœºå™¨äºº
          curl -X POST "$WEBHOOK" \
            -H "Content-Type: application/json" \
            -d "$JSON_PAYLOAD"
          
          # è¾“å‡ºå“åº”ï¼Œæ–¹ä¾¿æ’æŸ¥é—®é¢˜
          echo "å‘é€å®Œæˆï¼ŒPayload: $JSON_PAYLOAD"
